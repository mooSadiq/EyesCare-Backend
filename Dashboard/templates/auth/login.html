{% load static %}

<html
  lang="ar" dir="rtl"
  class="light-style layout-navbar-fixed layout-menu-fixed layout-compact"
  data-theme="theme-default"
  data-assets-path="{% static '/' %}"
  data-base-url="{{url}}"
  data-template="vertical-menu-template">
  <head>
    <meta charset="utf-8"/>
    <meta name="csrf-token" content="{{ csrf_token }}">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>
      ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    </title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <meta name="google-signin-client_id" content="87587319555-i5cute4uqqidlsoia8q6stljaodgtmko.apps.googleusercontent.com">

    <meta name="description" content="" />
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'img/favicon/logo1.ico' %}" />
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&ampdisplay=swap"
      rel="stylesheet" />
    <!-- Icons -->
    <link rel="stylesheet" href="{% static 'vendor/fonts/tabler-icons.css' %}" />
    <link rel="stylesheet" href="{% static 'vendor/fonts/fontawesome.css' %}" />
    <link rel="stylesheet" href="{% static 'vendor/fonts/flag-icons.css' %}" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="{% static 'vendor/css/rtl/core.css' %}" class="template-customizer-core-css" />
    <link rel="stylesheet" href="{% static 'vendor/css/rtl/theme-default.css' %}" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="{% static 'css/demo.css' %}" />
    <link rel="stylesheet" href="{% static 'vendor/css/pages/page-auth.css' %}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="{% static 'vendor/libs/node-waves/node-waves.css' %}" />
    <link rel="stylesheet" href="{% static 'vendor/libs/perfect-scrollbar/perfect-scrollbar.css' %}" />
    <link rel="stylesheet" href="{% static 'vendor/libs/typeahead-js/typeahead.css' %}" />
    <link rel="stylesheet" href="{% static 'vendor/libs/@form-validation/form-validation.css' %}" />
    <link rel="stylesheet" href="{% static 'vendor/css/pages/page-auth.css' %}" />

    {% comment %} helper {% endcomment %}

    <link rel="stylesheet" href="{% static 'vendor/libs/@form-validation/umd/styles/index.min.css' %}" />
    <script src="{% static 'vendor/libs/@form-validation/umd/bundle/popular.min.js' %}"></script>
    <script src="{% static 'vendor/libs/@form-validation/umd/plugin-bootstrap5/index.min.js' %}"></script>
    <script src="{% static 'vendor/libs/@form-validation/umd/plugin-auto-focus/index.min.js' %}"></script>
    <script src="{% static 'js/pages-auth.js' %}"></script>
    <script src="{% static 'js/ui-popover.js' %}"></script>

</head>

<body>
<div class="authentication-wrapper authentication-basic container-p-y">
  <div class="authentication-inner py-4">
    <!-- Login -->
    <div class="card">
      <div class="card-body">
        <!-- Logo -->
        <div class="app-brand justify-content-center mb-4 mt-2">
          <a href="{% url 'index' %}" class="app-brand-link gap-2">
            <span class="app-brand-text demo text-body fw-bold ms-1">EyesCare</span>
            <img src="{% static 'img/branding/logo1.png' %}" class="app-brand-logo demo" alt="">
          </a>
        </div>
        <!-- /Logo -->
        <h4 class="mb-4 pt-2">Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ  ÙÙŠ EyesCare! ğŸ‘‹</h4>
        <div id="message-container"></div>'
        <form id="formAuthentication" class="mb-3" action="" method="post">
          {% csrf_token %}
          <div class="mb-3">
              <label for="email" class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
              <input
                  type="email"
                  class="form-control"
                  id="email"
                  name="email"
                  placeholder="Enter your email"
                  autofocus />
          </div>
          <div class="mb-3 form-password-toggle">
              <div class="d-flex justify-content-between">
                  <label class="form-label" for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                  <a href="{% url 'forgot-password' %}">
                    <small>Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</small>
                </a>
              </div>
              <div class="input-group input-group-merge">
                  <input
                      type="password"
                      id="password"
                      class="form-control"
                      name="password"
                      placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;"
                      aria-describedby="password" />
                  <span class="input-group-text cursor-pointer"><i class="ti ti-eye-off"></i></span>
              </div>
          </div>
          <div class="mb-3">
              <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="remember-me" />
                  <label class="form-check-label" for="remember-me">ØªØ°ÙƒØ±Ù†ÙŠ</label>
              </div>
          </div>
          {% if request.GET.next %}
          <input type="hidden" name="next" value="{{request.GET.next}}">
          {% endif %}
          <div class="mb-3">
            <button class="btn btn-primary d-grid w-100" type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
          </div>
      </form>
    </div>
    <!-- /Login -->
  </div>
</div>
<script>
  const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
  document.getElementById('formAuthentication').addEventListener('submit', async function(event) {
      event.preventDefault();
  
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const messageContainer = document.getElementById('message-container');
      try {
          const response = await fetch('/auth/login/', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': csrfToken,
              },
              body: JSON.stringify({ email, password })
          });
          if (response.ok) {
              const data = await response.json();
              if (data.access_token && data.refresh_token && data.next_url) {
                  // ØªØ®Ø²ÙŠÙ† Ø§Ù„ØªÙˆÙƒÙ†Ø§Øª ÙÙŠ localStorage
                  localStorage.setItem('access_token', data.access_token);
                  localStorage.setItem('refresh_token', data.refresh_token);
                  window.location.href = data.next_url;
              } else {
                  messageContainer.innerHTML = '<div class="alert alert-danger" role="alert">Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±</div>';
              }
          } else {
              console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
              messageContainer.innerHTML = `<div class="alert alert-danger" role="alert">${data.message}</div>`;
          }
      } catch (error) {
          console.error('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±:', error);
          messageContainer.innerHTML = '<div class="alert alert-danger" role="alert">Ø­Ø¯Ø« Ø®Ø·Ø£. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹.</div>';
      }
  });
  </script>
</body>
</html>
